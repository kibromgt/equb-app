<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Equb App</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      direction: ltr;
    }
    button, .ussd-button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      margin: 5px 0;
    }
    input, select {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    .rtl {
      direction: rtl;
    }
  </style>
</head>
<body>
  <!-- Language Selector -->
  <select id="language" onchange="changeLanguage()">
    <option value="en">English</option>
    <option value="am">አማርኛ</option>
    <option value="ti">ትግርኛ</option>
    <option value="om">Oromoo</option>
  </select>

  <h1 id="title">Welcome to Equb App</h1>
  
  <!-- User Authentication -->
  <div id="auth-container">
    <h2 id="signup-title">Sign Up</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="signUp()" id="signup-btn">Create Account</button>
  </div>

  <!-- Equb Creation -->
  <div id="equb-container" style="display:none;">
    <h2 id="create-title">Create New Equb</h2>
    <input type="text" id="equb-name" placeholder="Equb Name">
    <input type="number" id="equb-amount" placeholder="Amount (ETB)">
    <button onclick="createEqub()" id="create-btn">Start Equb</button>
  </div>

  <!-- Payment Tracking -->
  <div id="payment-container" style="display:none; margin-top:20px;">
    <h2 id="payment-title">Payment Tracking</h2>
    <div id="payments-list"></div>
    <input type="number" id="payment-amount" placeholder="Amount (ETB)">
    <button onclick="recordPayment()" id="pay-btn">Record Payment</button>
  </div>

  <!-- USSD Option -->
  <div style="margin-top: 30px;">
    <p id="ussd-text">No smartphone? Dial:</p>
    <a href="tel:*384*12345%23" class="ussd-button" id="ussd-btn">*384*12345#</a>
  </div>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBuifsUfU-VvKCiavN-pdJtdx9Ennadth0",
      authDomain: "equb-web.firebaseapp.com",
      projectId: "equb-web",
      storageBucket: "equb-web.firebasestorage.app",
      messagingSenderId: "737801237955",
      appId: "1:737801237955:web:81617dfc5e85f347d0f976"
    };
    firebase.initializeApp(firebaseConfig);

    // Firebase services
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Language translations
    const translations = {
      en: {
        title: "Welcome to Equb App",
        signupTitle: "Sign Up",
        emailPlaceholder: "Email",
        passwordPlaceholder: "Password",
        signupBtn: "Create Account",
        createTitle: "Create New Equb",
        namePlaceholder: "Equb Name",
        amountPlaceholder: "Amount (ETB)",
        createBtn: "Start Equb",
        paymentTitle: "Payment Tracking",
        payBtn: "Record Payment",
        ussdText: "No smartphone? Dial:",
        ussdBtn: "*384*12345#",
        success: "Success!",
        error: "Error: "
      },
      am: {
        title: "ወደ እኩብ መተግበሪያ እንኳን ደህና መጡ",
        signupTitle: "ይመዝገቡ",
        emailPlaceholder: "ኢሜይል",
        passwordPlaceholder: "ይለፍ ቃል",
        signupBtn: "መለያ ይፍጠሩ",
        createTitle: "አዲስ እኩብ ይፍጠሩ",
        namePlaceholder: "የእኩብ ስም",
        amountPlaceholder: "መጠን (ብር)",
        createBtn: "እኩብ ጀምር",
        paymentTitle: "ክፍያ መከታተያ",
        payBtn: "ክፍያ ይመዝግቡ",
        ussdText: "ስልክ የለህም? ይደውሉ:",
        ussdBtn: "*384*12345#",
        success: "ተሳክቷል!",
        error: "ስህተት: "
      },
      ti: {
        title: "እንቋዕ ናብ እኩብ መተግበሪያ ብደሓን መጻእኩም",
        signupTitle: "ተመዝገብ",
        emailPlaceholder: "ኢመይል",
        passwordPlaceholder: "መሕለፊ ቃል",
        signupBtn: "ሕሳብ ፍጠር",
        createTitle: "ሓድሽ እኩብ ፍጠር",
        namePlaceholder: "ስም እኩብ",
        amountPlaceholder: "ገንዘብ (ብር)",
        createBtn: "እኩብ ጀምር",
        paymentTitle: "ክፍሊት መክትተል",
        payBtn: "ክፍሊት መዝግብ",
        ussdText: "ስማርትፎን የብልካን፧ ደውሉ፦",
        ussdBtn: "*384*12345#",
        success: "ተሳክቷል!",
        error: "ጌጋ: "
      },
      om: {
        title: "Equb App kanaa bilisoomfadha",
        signupTitle: "Galmaa'uu",
        emailPlaceholder: "Imeelii",
        passwordPlaceholder: "Jecha darbii",
        signupBtn: "Akkaawuntii uumu",
        createTitle: "Equb haaraa uumu",
        namePlaceholder: "Maqaa equbii",
        amountPlaceholder: "Qarshii (Birr)",
        createBtn: "Equb jalqabi",
        paymentTitle: "Kaffaltii hordofuu",
        payBtn: "Kaffaltii galmeessi",
        ussdText: "Smartphone hin qabduu? Bilbilaa:",
        ussdBtn: "*384*12345#",
        success: "Milkaa'inaan!",
        error: "Dogoggora: "
      }
    };

    // Change language
    function changeLanguage() {
      const lang = document.getElementById('language').value;
      const t = translations[lang];
      
      // Update all text elements
      document.getElementById('title').textContent = t.title;
      document.getElementById('signup-title').textContent = t.signupTitle;
      document.getElementById('email').placeholder = t.emailPlaceholder;
      document.getElementById('password').placeholder = t.passwordPlaceholder;
      document.getElementById('signup-btn').textContent = t.signupBtn;
      document.getElementById('create-title').textContent = t.createTitle;
      document.getElementById('equb-name').placeholder = t.namePlaceholder;
      document.getElementById('equb-amount').placeholder = t.amountPlaceholder;
      document.getElementById('create-btn').textContent = t.createBtn;
      document.getElementById('payment-title').textContent = t.paymentTitle;
      document.getElementById('pay-btn').textContent = t.payBtn;
      document.getElementById('ussd-text').textContent = t.ussdText;
      document.getElementById('ussd-btn').textContent = t.ussdBtn;
      
      // Set RTL for Amharic/Tigrinya
      document.body.className = lang === 'am' || lang === 'ti' ? 'rtl' : '';
    }

    // Sign up function
    function signUp() {
      const lang = document.getElementById('language').value;
      const t = translations[lang];
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          document.getElementById('auth-container').style.display = 'none';
          document.getElementById('equb-container').style.display = 'block';
          document.getElementById('payment-container').style.display = 'block';
          alert(t.success);
        })
        .catch((error) => {
          alert(t.error + error.message);
        });
    }

    // Create Equb function
    function createEqub() {
      const lang = document.getElementById('language').value;
      const t = translations[lang];
      const name = document.getElementById('equb-name').value;
      const amount = document.getElementById('equb-amount').value;
      const userId = auth.currentUser.uid;

      db.collection("equbs").add({
        name: name,
        amount: amount,
        creator: userId,
        members: [userId],
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        alert(t.success);
      })
      .catch((error) => {
        alert(t.error + error);
      });
    }

    // Record payment
    function recordPayment() {
      const amount = document.getElementById('payment-amount').value;
      const paymentsList = document.getElementById('payments-list');
      const paymentItem = document.createElement('div');
      paymentItem.textContent = `Payment: ${amount} ETB - ${new Date().toLocaleString()}`;
      paymentsList.appendChild(paymentItem);
      document.getElementById('payment-amount').value = '';
    }

    // Auto-show equb form if already logged in
    auth.onAuthStateChanged((user) => {
      if (user) {
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('equb-container').style.display = 'block';
        document.getElementById('payment-container').style.display = 'block';
      }
    });
  </script>
</body>
</html>
